

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>widgets &mdash; Pyto  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="UI" href="widgets/ui.html" />
    <link rel="prev" title="Constants" href="pyto_ui/constants.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Pyto
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="automation.html">Automation with Shortcuts and x-callback URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="external.html">Accessing external files</a></li>
<li class="toctree-l1"><a class="reference internal" href="opencv.html">OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="django.html">Using Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="third_party.html">Third Party Libraries</a></li>
</ul>
<p class="caption"><span class="caption-text">ObjC Runtime</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Objective-C.html">Objective-C</a></li>
</ul>
<p class="caption"><span class="caption-text">User Interface</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="pyto_ui.html">pyto_ui</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">widgets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#api-reference">API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="widgets/ui.html">UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="widgets/constants.html">Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="widgets/functions.html">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#types-of-widgets">Types of widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a></li>
</ul>
</li>
<<<<<<< HEAD
<li class="toctree-l1"><a class="reference internal" href="watch.html">watch</a></li>
=======
<li class="toctree-l1"><a class="reference internal" href="pyto_core.html">pyto_core</a></li>
<li class="toctree-l1"><a class="reference internal" href="notification_center.html">notification_center</a></li>
>>>>>>> 9ec484051b222280c44a9356f1eb31cfa9a71619
<li class="toctree-l1"><a class="reference internal" href="sound.html">sound</a></li>
<li class="toctree-l1"><a class="reference internal" href="sf_symbols.html">sf_symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="sharing.html">sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="mainthread.html">mainthread</a></li>
<<<<<<< HEAD
<li class="toctree-l1"><a class="reference internal" href="pyto_core.html">pyto_core</a></li>
=======
>>>>>>> 9ec484051b222280c44a9356f1eb31cfa9a71619
</ul>
<p class="caption"><span class="caption-text">OS Technologies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notifications.html">notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote_notifications.html">remote_notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">background</a></li>
<li class="toctree-l1"><a class="reference internal" href="bookmarks.html">bookmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="music.html">music</a></li>
<li class="toctree-l1"><a class="reference internal" href="photos.html">photos</a></li>
<li class="toctree-l1"><a class="reference internal" href="location.html">location</a></li>
<li class="toctree-l1"><a class="reference internal" href="motion.html">motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="multipeer.html">multipeer</a></li>
<li class="toctree-l1"><a class="reference internal" href="speech.html">speech</a></li>
</ul>
<p class="caption"><span class="caption-text">Sharing data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apps.html">apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="xcallback.html">xcallback</a></li>
<li class="toctree-l1"><a class="reference internal" href="userkeys.html">userkeys</a></li>
<li class="toctree-l1"><a class="reference internal" href="pasteboard.html">pasteboard</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Pyto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>widgets</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/widgets.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-widgets">
<span id="widgets"></span><h1>widgets<a class="headerlink" href="#module-widgets" title="Permalink to this headline">¶</a></h1>
<p>Home Screen Widgets</p>
<p>Since iOS / iPadOS 14, multiple widgets from the same app can be displayed in the home screen. That changed the way widgets work.
Before iOS 14, widgets were dynamic which means that a script’s output could be displayed at real time and views were interactive. 
However, that changed. Now widgets are not really interactive. The UI cannot be changed after being presented. That means a widget now provides a static UI multiple times a day.</p>
<p>Individual UI elements can open the script in foreground except on the small layout, where only the whole widget can be pressed.</p>
<p>Scripts can determine when a widget will be reloaded, for example each hour.
While the UI is not interactive, UI elements can open the script in foreground to do a certain task. So coding some kind of launcher is possible.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This library requires iOS 14+</p>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="widgets/ui.html">UI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="widgets/ui.html#widget-configuration">Widget Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/ui.html#ui-elements">UI Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/ui.html#data-types">Data Types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="widgets/constants.html">Constants</a><ul>
<li class="toctree-l2"><a class="reference internal" href="widgets/constants.html#ui-elements-colors">UI Elements Colors</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/constants.html#standard-colors">Standard Colors</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/constants.html#fixed-colors">Fixed Colors</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/constants.html#font-text-style">Font Text Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/constants.html#font-size">Font Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/constants.html#padding">Padding</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/constants.html#date-style">Date Style</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="widgets/functions.html">Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="widgets/functions.html#showing-a-native-ui">Showing a native UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="widgets/functions.html#showing-a-pytoui-view">Showing a PytoUI view</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="types-of-widgets">
<h2>Types of widgets<a class="headerlink" href="#types-of-widgets" title="Permalink to this headline">¶</a></h2>
<p>There are two types of widgets:</p>
<p><strong>Run Script</strong>: A script running in background to update the widget content automatically. The scripts runs with a very limited amount of RAM and cannot import most of the bundled libraries. Scripts can access resources or import other modules and packages installed with PyPI are also available but libraries with C extensions like Numpy (except PIL) cannot be imported.</p>
<<<<<<< HEAD
<p><strong>In App</strong>: A script executed manually in foreground that will provide an UI for a widget. The scripts can do everything a script running in foreground can. This is very powerful with Shortcuts automations or with <a class="reference internal" href="background.html#background.request_background_fetch" title="background.request_background_fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">request_background_fetch()</span></code></a>.</p>
<p>Since Pyto 14.0, ‘Run Script’ widgets can be executed in app by calling the “Start Handling Widgets In App” Shortcut. After running the shortcut, the app will run in background and will be notified when a widget is about to be reloaded so it runs without RAM limit and it can import libraries with C extensions like Numpy. That’s basically handling widgets in app but without having to care about reloading the widget in a while loop, the app will take care and run the scripts when required. You should run the “Start Handling Widgets In App” shortcut from Shortcuts automation, for example once a day to make sure the app is running in background, having it in the app switcher isn’t enough.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>As an example, we will code a widget that shows the current date and week day.</p>
<p>Firstly, we will import the required libraries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">widgets</span> <span class="kn">as</span> <span class="nn">wd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</pre></div>
</div>
<p>We will start by defining the text foreground color and the background color for the widget’s UI.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BACKGROUND</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">250</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">227</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
<span class="n">FOREGROUND</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">75</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">72</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we’ll declare a function that returns the weekday of a ‘datetime’ object as a string.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">weekday</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Monday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Tuesday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Wednesday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Thursday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Friday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Saturday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Sunday&quot;</span>
</pre></div>
</div>
<p>To provide the widgets, we need to declare a subclass of <a class="reference internal" href="widgets/ui.html#widgets.TimelineProvider" title="widgets.TimelineProvider"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimelineProvider</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DateProvider</span><span class="p">(</span><span class="n">wd</span><span class="o">.</span><span class="n">TimelineProvider</span><span class="p">):</span>
</pre></div>
</div>
<p>Two methods must be implemented: <a class="reference internal" href="widgets/ui.html#widgets.TimelineProvider.timeline" title="widgets.TimelineProvider.timeline"><code class="xref py py-meth docutils literal notranslate"><span class="pre">timeline()</span></code></a> and <a class="reference internal" href="widgets/ui.html#widgets.TimelineProvider.widget" title="widgets.TimelineProvider.widget"><code class="xref py py-meth docutils literal notranslate"><span class="pre">widget()</span></code></a>.</p>
<p>Let’s start by <a class="reference internal" href="widgets/ui.html#widgets.TimelineProvider.timeline" title="widgets.TimelineProvider.timeline"><code class="xref py py-meth docutils literal notranslate"><span class="pre">timeline()</span></code></a>. This method returns a list of dates for which the script has data.
As we are creating a calendar widget, we need to update it everyday at midnight. We will cache the next 30 days.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dates</span>
</pre></div>
</div>
<p>The method above returns the next 30 days dates at midnight. Then we need to provide a widget for each date.</p>
<p>We will code the UI. Each widget has 3 layouts: small, medium and large. So we need to provide a different layout for each size.
A layout is composed of rows, each row containing horizontally aligned UI elements.
The small layout is a small square, the medium layout is a rectangle and the large one is a big square.</p>
<blockquote>
<div><p>A <a class="reference internal" href="widgets/ui.html#widgets.Widget" title="widgets.Widget"><code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code></a> instance has 3 properties that can be used to modify the layout of each widget size. <a class="reference internal" href="widgets/ui.html#widgets.Widget.small_layout" title="widgets.Widget.small_layout"><code class="xref py py-data docutils literal notranslate"><span class="pre">small_layout</span></code></a>, <a class="reference internal" href="widgets/ui.html#widgets.Widget.medium_layout" title="widgets.Widget.medium_layout"><code class="xref py py-data docutils literal notranslate"><span class="pre">medium_layout</span></code></a>, <a class="reference internal" href="widgets/ui.html#widgets.Widget.large_layout" title="widgets.Widget.large_layout"><code class="xref py py-data docutils literal notranslate"><span class="pre">large_layout</span></code></a></p>
</div></blockquote>
<p>The <a class="reference internal" href="widgets/ui.html#widgets.Widget" title="widgets.Widget"><code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code></a> object must be returned from the <a class="reference internal" href="widgets/ui.html#widgets.TimelineProvider.widget" title="widgets.TimelineProvider.widget"><code class="xref py py-meth docutils literal notranslate"><span class="pre">widget()</span></code></a>. The <code class="docutils literal notranslate"><span class="pre">date</span></code> parameter is a <code class="docutils literal notranslate"><span class="pre">datetime</span></code> object corresponding to the date when the widget will be displayed. For this example, we will use the medium layout only.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Widget</span><span class="p">()</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">medium_layout</span>
</pre></div>
</div>
<p>Firstly, we will create a <a class="reference internal" href="widgets/ui.html#widgets.Text" title="widgets.Text"><code class="xref py py-class docutils literal notranslate"><span class="pre">Text</span></code></a> showing the week day corresponding to the given date.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">day</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="n">weekday</span><span class="p">(</span><span class="n">date</span><span class="p">),</span>
    <span class="n">font</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="s2">&quot;AmericanTypewriter-Bold&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND</span><span class="p">)</span>
</pre></div>
</div>
<p>To show the current formatted date, we can use <a class="reference internal" href="widgets/ui.html#widgets.DynamicDate" title="widgets.DynamicDate"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicDate</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">date_text</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">DynamicDate</span><span class="p">(</span>
    <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="s2">&quot;AmericanTypewriter&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND</span><span class="p">,</span>
    <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">PADDING_ALL</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we place the the week day at center and the date at the bottom. <code class="xref py py-meth docutils literal notranslate"><span class="pre">add_vertical_layout()</span></code> adds an invisible space that takes as much as vertical space as it can. The <a class="reference internal" href="widgets/ui.html#widgets.WidgetLayout.set_link" title="widgets.WidgetLayout.set_link"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_link()</span></code></a> method sets a parameter that will be passed to the script when the widget is pressed, the <a class="reference internal" href="widgets/ui.html#widgets.WidgetComponent.link" title="widgets.WidgetComponent.link"><code class="xref py py-data docutils literal notranslate"><span class="pre">link</span></code></a> property can be set for individual UI elements.</p>
<p>See <a class="reference external" href="widgets/ui.html#ui-elements">UI Elements</a> for a list of UI elements and their documentation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span><span class="o">.</span><span class="n">add_vertical_spacer</span><span class="p">()</span>
<span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="n">day</span><span class="p">])</span>
<span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="n">date_text</span><span class="p">])</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_background_color</span><span class="p">(</span><span class="n">BACKGROUND</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_link</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">ctime</span><span class="p">())</span>

<span class="k">return</span> <span class="n">widget</span>
</pre></div>
</div>
<p>Call the <a class="reference internal" href="widgets/functions.html#widgets.provide_timeline" title="widgets.provide_timeline"><code class="xref py py-func docutils literal notranslate"><span class="pre">provide_timeline()</span></code></a> function to show the widget:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wd</span><span class="o">.</span><span class="n">provide_timeline</span><span class="p">(</span><span class="n">DateProvider</span><span class="p">())</span>
</pre></div>
</div>
<p>And we can check for the <a class="reference internal" href="widgets/ui.html#widgets.link" title="widgets.link"><code class="xref py py-data docutils literal notranslate"><span class="pre">link</span></code></a> variable to use the passed parameter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">wd</span><span class="o">.</span><span class="n">link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">wd</span><span class="o">.</span><span class="n">link</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">wd</span><span class="o">.</span><span class="n">provide_timeline</span><span class="p">(</span><span class="n">DateProvider</span><span class="p">())</span>
</pre></div>
</div>
<p>The script looks like that:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">widgets</span> <span class="kn">as</span> <span class="nn">wd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">BACKGROUND</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">250</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">227</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
<span class="n">FOREGROUND</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">75</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">72</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">55</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">weekday</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Monday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Tuesday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Wednesday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Thursday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Friday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Saturday&quot;</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Sunday&quot;</span>

<span class="k">class</span> <span class="nc">DateProvider</span><span class="p">(</span><span class="n">wd</span><span class="o">.</span><span class="n">TimelineProvider</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">timeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dates</span>

    <span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Widget</span><span class="p">()</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">medium_layout</span>

        <span class="n">day</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">weekday</span><span class="p">(</span><span class="n">date</span><span class="p">),</span>
            <span class="n">font</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="s2">&quot;AmericanTypewriter-Bold&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND</span><span class="p">)</span>

        <span class="n">date_text</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">DynamicDate</span><span class="p">(</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="s2">&quot;AmericanTypewriter&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">PADDING_ALL</span><span class="p">)</span>

        <span class="n">layout</span><span class="o">.</span><span class="n">add_vertical_spacer</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="n">day</span><span class="p">])</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span><span class="n">date_text</span><span class="p">])</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">set_background_color</span><span class="p">(</span><span class="n">BACKGROUND</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">set_link</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">ctime</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">widget</span>

<span class="k">if</span> <span class="n">wd</span><span class="o">.</span><span class="n">link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">wd</span><span class="o">.</span><span class="n">link</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">wd</span><span class="o">.</span><span class="n">provide_timeline</span><span class="p">(</span><span class="n">DateProvider</span><span class="p">())</span>
</pre></div>
</div>
<p>After running the script, it will be selectable in the “Run Script” widget.</p>
<p>If your widget doesn’t have any data for the future, instead of providing a timeline you can provide a single widget and request a refresh after a certain delay. See <a class="reference internal" href="widgets/functions.html#widgets.show_widget" title="widgets.show_widget"><code class="xref py py-func docutils literal notranslate"><span class="pre">show_widget()</span></code></a> and <a class="reference internal" href="widgets/functions.html#widgets.schedule_next_reload" title="widgets.schedule_next_reload"><code class="xref py py-func docutils literal notranslate"><span class="pre">schedule_next_reload()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">widgets</span> <span class="kn">as</span> <span class="nn">wd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="n">widget</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Widget</span><span class="p">()</span>

<span class="o">...</span>

<span class="n">wd</span><span class="o">.</span><span class="n">schedule_next_reload</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">wd</span><span class="o">.</span><span class="n">show_widget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
=======
<p><strong>Set Content in App</strong>: A script executed manually in foreground that will provide an UI for a widget. The scripts can do everything a script running in foreground can. This is very powerful with Shortcuts automations or with <a class="reference internal" href="background.html#background.request_background_fetch" title="background.request_background_fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">request_background_fetch()</span></code></a>.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>As an example, we will code a widget that shows the latest posts from <a class="reference external" href="https://daringfireball.net/">Daring Fireball</a>.</p>
<p>Firstly, we will import the required libraries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">widgets</span> <span class="kn">as</span> <span class="nn">wd</span> <span class="c1"># For the UI</span>
<span class="kn">import</span> <span class="nn">json</span> <span class="c1"># For parsing the feed</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span> <span class="c1"># For requesting the feed</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span> <span class="c1"># For parsing dates</span>
<span class="kn">from</span> <span class="nn">webbrowser</span> <span class="kn">import</span> <span class="nb">open</span> <span class="c1"># For opening posts</span>
</pre></div>
</div>
<p>We will start by defining some values. The text foreground color and the background color used on the widget’s UI. <code class="docutils literal notranslate"><span class="pre">FEED_URL</span></code> stores an URL that gives all the posts from the blog in a JSON format.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FOREGROUND_COLOR</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">COLOR_WHITE</span>
<span class="n">BACKGROUND_COLOR</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">74</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">82</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">90</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
<span class="n">FEED_URL</span> <span class="o">=</span> <span class="s2">&quot;https://daringfireball.net/feeds/json&quot;</span>
</pre></div>
</div>
<p>Then we’ll declare a class to store posts information. Each post has an URL, a title, a publication date and the content itself.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
</pre></div>
</div>
<p>After that, we’ll declare a function that returns a all of the articles in the feed as a list. Each <code class="docutils literal notranslate"><span class="pre">Article</span></code> object is created from the information parsed as JSON.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_posts</span><span class="p">():</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">FEED_URL</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">feed</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">feed</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span>

    <span class="n">articles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;content_html&quot;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;date_published&quot;</span><span class="p">])</span>
        <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="n">articles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">articles</span>
</pre></div>
</div>
<p>Now we will code the UI. Each widget has 3 layouts: small, medium and large. So we need to provide a different layout for each size.
A layout is composed of rows, each row containing horizontally aligned UI elements.
The small layout is a small square, the medium layout is a rectangle and the large one is a big square.</p>
<p>We need to create a <a class="reference internal" href="widgets/ui.html#widgets.Widget" title="widgets.Widget"><code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code></a> object and store the blog’s feed returned by <code class="docutils literal notranslate"><span class="pre">get_posts()</span></code>. A <a class="reference internal" href="widgets/ui.html#widgets.Widget" title="widgets.Widget"><code class="xref py py-class docutils literal notranslate"><span class="pre">Widget</span></code></a> instance has 3 properties that can be used to modify the layout of each widget size. <a class="reference internal" href="widgets/ui.html#widgets.Widget.small_layout" title="widgets.Widget.small_layout"><code class="xref py py-data docutils literal notranslate"><span class="pre">small_layout</span></code></a>, <a class="reference internal" href="widgets/ui.html#widgets.Widget.medium_layout" title="widgets.Widget.medium_layout"><code class="xref py py-data docutils literal notranslate"><span class="pre">medium_layout</span></code></a>, <a class="reference internal" href="widgets/ui.html#widgets.Widget.large_layout" title="widgets.Widget.large_layout"><code class="xref py py-data docutils literal notranslate"><span class="pre">large_layout</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">posts</span> <span class="o">=</span> <span class="n">get_posts</span><span class="p">()</span>
<span class="n">widget</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Widget</span><span class="p">()</span>
</pre></div>
</div>
<p>While the medium sized widget will contain the title and the content of a post, the large layout will contain 3 posts. So we create a function that can add the UI to a layout, then we would just need to call this function once for the medium layout and 3 times for the large layout.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_post</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

    <span class="c1"># If &#39;line&#39; is &#39;True&#39;, the UI elements will be tappable</span>

    <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">url</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Add the title of the post</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
            <span class="n">link</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Font</span><span class="o">.</span><span class="n">bold_system_font_of_size</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">])</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_vertical_spacer</span><span class="p">()</span>

    <span class="c1"># Add the content of the post</span>
    <span class="c1"># post.content can contain HTML code</span>
    <span class="c1"># HTML code is automatically converted into plain text (no markup)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
            <span class="n">link</span><span class="o">=</span><span class="n">url</span>
        <span class="p">),</span>
    <span class="p">])</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_vertical_spacer</span><span class="p">()</span>

    <span class="c1"># Add the publication date</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">Spacer</span><span class="p">(),</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">DynamicDate</span><span class="p">(</span>
            <span class="n">post</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">],</span> <span class="n">link</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># Set the background color of the widget</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_background_color</span><span class="p">(</span><span class="n">BACKGROUND_COLOR</span><span class="p">)</span>
</pre></div>
</div>
<p>The small widget just contains the title and the publication date of the last post. The first element of the <code class="docutils literal notranslate"><span class="pre">posts</span></code> list is the last post.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># # # # #</span>
<span class="c1"># Small #</span>
<span class="c1"># # # # #</span>

<span class="c1"># Add the post&#39;s title</span>
<span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
    <span class="n">wd</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
        <span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Font</span><span class="o">.</span><span class="n">bold_system_font_of_size</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Add the publication date at the bottom</span>
<span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">add_vertical_spacer</span><span class="p">()</span>
<span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
    <span class="n">wd</span><span class="o">.</span><span class="n">Spacer</span><span class="p">(),</span>
    <span class="n">wd</span><span class="o">.</span><span class="n">DynamicDate</span><span class="p">(</span>
        <span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>

<span class="c1"># If the widget is pressed, the post&#39;s URL will be passed to the script</span>
<span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">set_link</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Set the background color of the widget</span>
<span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">set_background_color</span><span class="p">(</span><span class="n">BACKGROUND_COLOR</span><span class="p">)</span>
</pre></div>
</div>
<p>For the medium widget, we just call the previously created <code class="docutils literal notranslate"><span class="pre">add_post</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># # # # # #</span>
<span class="c1"># Medium  #</span>
<span class="c1"># # # # # #</span>

<span class="n">add_post</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">widget</span><span class="o">.</span><span class="n">medium_layout</span><span class="p">)</span>

<span class="c1"># If the widget is pressed, the post&#39;s URL will be passed to the script</span>
<span class="n">widget</span><span class="o">.</span><span class="n">medium_layout</span><span class="o">.</span><span class="n">set_link</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>The large widget will contain 3 posts, so we call <code class="docutils literal notranslate"><span class="pre">add_post</span></code> 3 times. This time, we set the third parameter (<code class="docutils literal notranslate"><span class="pre">link</span></code>) to <code class="docutils literal notranslate"><span class="pre">True</span></code>. Because the large widget contains multiple posts, the <code class="docutils literal notranslate"><span class="pre">link</span></code> attribute isn’t set to the whole layout but to individual UI elements.</p>
<p>Between each post, we add a tinny line with <code class="xref py py-meth docutils literal notranslate"><span class="pre">add_vertical_divider()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># # # # #</span>
<span class="c1"># Large #</span>
<span class="c1"># # # # #</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="c1"># Setting the third parameter to &#39;True&#39; will make individual elements tappable</span>
    <span class="n">add_post</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">widget</span><span class="o">.</span><span class="n">large_layout</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">large_layout</span><span class="o">.</span><span class="n">add_vertical_divider</span><span class="p">()</span>
</pre></div>
</div>
<p>Then we can just show the widget with <a class="reference internal" href="widgets/functions.html#widgets.show_widget" title="widgets.show_widget"><code class="xref py py-func docutils literal notranslate"><span class="pre">show_widget()</span></code></a>. You can run the code in app and see a preview. A reload is scheduled with <a class="reference internal" href="widgets/functions.html#widgets.schedule_next_reload" title="widgets.schedule_next_reload"><code class="xref py py-func docutils literal notranslate"><span class="pre">schedule_next_reload()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># # # # #</span>
<span class="c1"># Show  #</span>
<span class="c1"># # # # #</span>

<span class="c1"># Don&#39;t reload before five hours</span>
<span class="n">wd</span><span class="o">.</span><span class="n">schedule_next_reload</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
<span class="n">wd</span><span class="o">.</span><span class="n">show_widget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the UI is correctly displayed, but now we need to handle taps to open an article.
<a class="reference internal" href="widgets/ui.html#widgets.link" title="widgets.link"><code class="xref py py-data docutils literal notranslate"><span class="pre">link</span></code></a> is set when an UI element with a <code class="docutils literal notranslate"><span class="pre">link</span></code> attribute is passed. So we need to check if this variable is set before showing the UI. If it’s not, that means the widget is running normally and we need to show an UI, otherwise we open the passed link with the default web browser.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">wd</span><span class="o">.</span><span class="n">link</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

    <span class="c1"># If the device was recently restarted,</span>
    <span class="c1"># it will wait until it&#39;s connected to the internet</span>
    <span class="n">wd</span><span class="o">.</span><span class="n">wait_for_internet_connection</span><span class="p">()</span>

    <span class="n">posts</span> <span class="o">=</span> <span class="n">get_posts</span><span class="p">()</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Widget</span><span class="p">()</span>

    <span class="o">...</span>

    <span class="n">wd</span><span class="o">.</span><span class="n">show_widget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Open the article with the default web browser</span>

    <span class="nb">open</span><span class="p">(</span><span class="n">wd</span><span class="o">.</span><span class="n">link</span><span class="p">)</span>
</pre></div>
</div>
<p>The script looks like that:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A widget that shows the latest posts from Daring Fireball (https://daringfireball.net).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">widgets</span> <span class="kn">as</span> <span class="nn">wd</span> <span class="c1"># For the UI</span>
<span class="kn">import</span> <span class="nn">json</span> <span class="c1"># For parsing the feed</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span> <span class="c1"># For requesting the feed</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span> <span class="c1"># For parsing dates</span>
<span class="kn">from</span> <span class="nn">webbrowser</span> <span class="kn">import</span> <span class="nb">open</span> <span class="c1"># For opening posts</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">FOREGROUND_COLOR</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">COLOR_WHITE</span>
<span class="n">BACKGROUND_COLOR</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">74</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">82</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">90</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
<span class="n">FEED_URL</span> <span class="o">=</span> <span class="s2">&quot;https://daringfireball.net/feeds/json&quot;</span>

<span class="k">class</span> <span class="nc">Article</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>

<span class="k">def</span> <span class="nf">get_posts</span><span class="p">():</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">FEED_URL</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">feed</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">feed</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span>

    <span class="n">articles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;content_html&quot;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;date_published&quot;</span><span class="p">])</span>
        <span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="n">articles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">articles</span>

<span class="k">def</span> <span class="nf">add_post</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

    <span class="c1"># If &#39;line&#39; is &#39;True&#39;, the UI elements will be tappable</span>

    <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">url</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Add the title of the post</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Font</span><span class="o">.</span><span class="n">bold_system_font_of_size</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">],</span> <span class="n">link</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_vertical_spacer</span><span class="p">()</span>

    <span class="c1"># Add the content of the post</span>
    <span class="c1"># post.content can contain HTML code</span>
    <span class="c1"># HTML code is automatically converted into plain text (no markup)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
            <span class="n">link</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">PADDING_HORIZONTAL</span>
        <span class="p">),</span>
    <span class="p">])</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_vertical_spacer</span><span class="p">()</span>

    <span class="c1"># Add the publication date</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">Spacer</span><span class="p">(),</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">DynamicDate</span><span class="p">(</span>
            <span class="n">post</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">],</span> <span class="n">link</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># Set the background color of the widget</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_background_color</span><span class="p">(</span><span class="n">BACKGROUND_COLOR</span><span class="p">)</span>

<span class="k">if</span> <span class="n">wd</span><span class="o">.</span><span class="n">link</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

    <span class="n">wd</span><span class="o">.</span><span class="n">wait_for_internet_connection</span><span class="p">()</span>

    <span class="n">posts</span> <span class="o">=</span> <span class="n">get_posts</span><span class="p">()</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">Widget</span><span class="p">()</span>

    <span class="c1"># # # # #</span>
    <span class="c1"># Small #</span>
    <span class="c1"># # # # #</span>

    <span class="c1"># Add the post&#39;s title</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Font</span><span class="o">.</span><span class="n">bold_system_font_of_size</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">])</span>

    <span class="c1"># Add the publication date at the bottom</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">add_vertical_spacer</span><span class="p">()</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
        <span class="n">wd</span><span class="o">.</span><span class="n">DynamicDate</span><span class="p">(</span>
            <span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">FOREGROUND_COLOR</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">wd</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">])</span>

    <span class="c1"># If the widget is pressed, the post&#39;s URL will be passed to the script</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">set_link</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># Set the background color of the widget</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">small_layout</span><span class="o">.</span><span class="n">set_background_color</span><span class="p">(</span><span class="n">BACKGROUND_COLOR</span><span class="p">)</span>

    <span class="c1"># # # # # #</span>
    <span class="c1"># Medium  #</span>
    <span class="c1"># # # # # #</span>

    <span class="n">add_post</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">widget</span><span class="o">.</span><span class="n">medium_layout</span><span class="p">)</span>

    <span class="c1"># If the widget is pressed, the post&#39;s URL will be passed to the script</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">medium_layout</span><span class="o">.</span><span class="n">set_link</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># # # # #</span>
    <span class="c1"># Large #</span>
    <span class="c1"># # # # #</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="c1"># Setting the third parameter to &#39;True&#39; will make individual elements tappable</span>
        <span class="n">add_post</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">widget</span><span class="o">.</span><span class="n">large_layout</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">large_layout</span><span class="o">.</span><span class="n">add_vertical_divider</span><span class="p">()</span>

    <span class="c1"># # # # #</span>
    <span class="c1"># Show  #</span>
    <span class="c1"># # # # #</span>

    <span class="c1"># Don&#39;t reload before five hours</span>
    <span class="n">wd</span><span class="o">.</span><span class="n">schedule_next_reload</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">wd</span><span class="o">.</span><span class="n">show_widget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Open the article with the default web browser</span>

    <span class="nb">open</span><span class="p">(</span><span class="n">wd</span><span class="o">.</span><span class="n">link</span><span class="p">)</span>
>>>>>>> 9ec484051b222280c44a9356f1eb31cfa9a71619
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="widgets/ui.html" class="btn btn-neutral float-right" title="UI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pyto_ui/constants.html" class="btn btn-neutral float-left" title="Constants" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Adrian Labbé

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>