import sys

from pyto import PyInputHelper
from console import ignoredThreads
from rubicon.objc import *
import threading

import os

if "widget" in os.environ:
    raise ImportError("Cannot ask for input from a widget")

def getpass(prompt="", stream=sys.stdout):    
    NSBundle = ObjCClass("NSBundle")
    if NSBundle.mainBundle.bundlePath.pathExtension == "appex":
        return None
    
    print(prompt, end="")
    
    PyInputHelper.userInput = None
    
    try:
        __PyInputHelper__.showAlertWithPrompt(prompt, script=threading.current_thread().script_path)
    except AttributeError:
         PyInputHelper.getPassWithPrompt(prompt, script=None)
    
    
    while PyInputHelper.userInput is None or threading.currentThread() in ignoredThreads:
        continue
    
    userInput = PyInputHelper.userInput
    PyInputHelper.userInput = None
    
    return str(userInput)
